<!DOCTYPE HTML><html lang="en-US" class="no-js">
   <head><!-- PAGE HEAD -->
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0">
      <title>Center for High Performance Computing - The University of Utah</title>
      <meta name="keywords" content="">
      <meta name="description" content="">
      <meta name="robots" content="index,follow">
      <link rel="icon" href="//templates.utah.edu/_main-v3-1/images/template/favicon.ico">
      <link rel="apple-touch-icon-precomposed" href="//templates.utah.edu/_main-v3-1/images/template/apple-touch-icon.png">
      <link rel="stylesheet" href="//templates.utah.edu/_main-v3-1/css/main.min.css" type="text/css"><noscript>
         <link rel="stylesheet" href="//templates.utah.edu/_main-v3-1/css/assets/fontawesome/css/all.min.css" type="text/css"></noscript><link href="/_resources/css/custom.css" rel="stylesheet" type="text/css">
      <script src="//templates.utah.edu/_main-v3-1/js/head-code.min.js"></script>
      <!-- HEAD CODE -->
      
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-Y160DVJ0DZ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-Y160DVJ0DZ');
</script>

      
      <!-- END HEAD CODE -->
      <!-- END PAGE HEAD -->
      </head>
   <body class="has-headernav"><!-- PAGE BODY -->
      <a class="uu-skip-link" href="#skip-link-target">Skip to content</a>
      <!-- BODY TOP CODE -->
            <!-- END BODY TOP CODE -->
      
      <div id="uu-top-target" class="uu-site"><!-- SEARCH -->
         <div class="uu-search" role="search">
    <div class="uu-search__container">
        <!-- SITE SEARCH -->
        <form method="get" id="search-site" class="uu-search__form" action="/search/index.php">

            <label for="inputSearchSite" class="sr-only">Search Site:</label>
            <input type="text" id="inputSearchSite" name="q" value="" placeholder="Search Site" />
            <input type="hidden" name="gcse_action" value="site" />

            <div class="form-powered-by">
                <span>Powered by</span> 
                <img src="https://templates.utah.edu/_main-v3-1/images/template/google-logo.png" alt="Google Search">
            </div>

        </form>
        <!-- END SITE SEARCH -->
        <!-- CAMPUS SEARCH -->
        <form method="get" id="search-campus" class="uu-search__form" action="/search/index.php">

            <label for="inputSearchCampus" class="sr-only">Search Campus:</label>
            <input type="text" id="inputSearchCampus" name="q" value="" placeholder="Search Campus" />
            <input type="hidden" name="gcse_action" value="campus" />

            <div class="form-powered-by">
                <span>Powered by</span> 
                <img src="https://templates.utah.edu/_main-v3-1/images/template/google-logo.png" alt="Google Search">
            </div>
        </form>
        <!-- END CAMPUS SEARCH -->

        <!-- SEARCH TYPE TOGGLE -->
        <div class="search-type-toggle">
            <label class="uu-switch" for="search_campus_checkbox">
                <input type="checkbox" name="search_campus_checkbox" value="" id="search_campus_checkbox">
                <span class="uu-switch-slider"></span>
                <span class="uu-switch-label">Search Campus</span>
            </label>
        </div>
        <!-- END SEARCH TYPE TOGGLE -->

    </div>
</div><!-- END SEARCH -->
         <!-- HEADER -->
         
         <header class="uu-header">
            <div class="uu-header__container">
               <!-- ALERT AREA -->
               <div id="alert_bar" class="uu-alert-bar"> 
	<a href="https://coronavirus.utah.edu/">University of Utah COVID-19 Updates</a>
</div><!-- END ALERT AREA -->
               
               <div class="uu-header__top"> <a href="https://www.utah.edu/" class="uu-header__logo"><span class="sr-only">The University of Utah</span></a>                  <div class="uu-header__middle">
                     <!-- HEADER TITLE -->
                     <div class="uu-header__title">
<h2><a href="/">CHPC - Research Computing and Data Support for the University</a></h2>
<!-- <h3><a href="http://it.utah.edu">University Information Technology</a></h3> --></div><!-- END HEADER TITLE -->
                     <!-- HEADER NAVIGATION -->
                     
<nav class="uu-header__nav">
	
<ul class="uu-menu__level1">
<ul class="uu-menu__level1">
<li class="has-sub"><a href="#">About Us</a>
<ul class="sub-menu">
<li><a href="/about/index.php">About Us</a></li>
<li><a href="https://www.chpc.utah.edu/about/vision.php">vision</a></li>
<li><a href="/about/staff.php">Staff</a></li>
<li><a href="https://www.chpc.utah.edu/about/contact.php">Contact Information</a></li>
<li><a href="https://www.chpc.utah.edu/about/acknowledge.php">acknowledging chpc</a></li>
<li><a href="https://www.chpc.utah.edu/highlights.php">Research Highlights</a></li>
<li><a href="https://www.chpc.utah.edu/about/partners.php">Partners</a></li>
<li><a href="/news/index.php">news</a></li>
<li><a title="University Information Technology" href="https://it.utah.edu/" target="_blank" rel="noopener">UIT</a></li>
<li><a href="/about/governance.php">Governance</a></li>
</ul>
</li>
<li class="has-sub"><a href="#">Resources</a>
<ul class="sub-menu">
<li><a href="https://www.chpc.utah.edu/resources/index.php">Resources</a></li>
<li><a href="https://www.chpc.utah.edu/resources/HPC_Clusters.php">HPC Clusters</a></li>
<li><a href="/resources/storage_services.php">Storage Services</a></li>
<li><a href="https://www.chpc.utah.edu/documentation/data_services.php">Data Transfer Services</a></li>
<li><a href="/resources/virtualmachines.php">Virtual Machines</a></li>
<li><a href="/resources/hosting.php">Hosting Services</a></li>
<li><a href="/resources/Networking.php">Networking</a></li>
<li><a href="/resources/ProtectedEnvironment.php">Protected Environment</a></li>
<li><a href="/userservices/index.php">User Services</a></li>
</ul>
</li>
<li class="has-sub sub-width-lg"><a href="#">Documentation</a>
<ul class="sub-menu">
<li><a href="https://www.chpc.utah.edu/documentation/index.php">Documentation</a></li>
<li><a href="https://www.chpc.utah.edu/documentation/gettingstarted.php">Getting Started</a></li>
<li><a href="https://www.chpc.utah.edu/resources/access.php">Accessing Our Resources</a></li>
<li><a href="https://www.chpc.utah.edu/documentation/videos/index.php">Short Training Videos</a></li>
<li><a href="https://www.chpc.utah.edu/documentation/guides/index.php">Cluster Guides</a></li>
<li><a href="https://www.chpc.utah.edu/documentation/guides/beehive.php">Beehive User Guide (Windows Server)</a></li>
<li><a href="https://www.chpc.utah.edu/documentation/guides/gpus-accelerators.php">GPU &amp; Accelerators</a></li>
<li><a href="https://www.chpc.utah.edu/documentation/guides/frisco-nodes.php">Frisco Nodes</a></li>
<li><a href="https://www.chpc.utah.edu/documentation/guides/narwhal.php">Narwhal User Guide (Protected Environment Statistics)</a></li>
<li><a href="https://www.chpc.utah.edu/documentation/software/index.php">Software</a></li>
<li><a href="https://www.chpc.utah.edu/documentation/ProgrammingGuide.php">Programming Guide</a></li>
<li><a href="https://www.chpc.utah.edu/documentation/policies/index.php">Policy Manual</a></li>
<li><a href="https://www.chpc.utah.edu/documentation/data_services.php">Data Transfer Services</a></li>
<li><a href="https://www.chpc.utah.edu/documentation/guides/HelloWorldMPI.php">HPC Basics - Hello World MPI</a></li>
<li><a href="https://www.chpc.utah.edu/documentation/faq.php">Frequently Asked Questions</a></li>
<li><a href="https://www.chpc.utah.edu/documentation/white_papers/index.php">White Papers</a></li>
</ul>
</li>
<li class="has-sub"><a href="#">User Services</a>
<ul class="sub-menu">
<li><a href="/userservices/index.php">User Services</a></li>
<li><a href="https://www.chpc.utah.edu/userservices/accounts.php">Accounts</a></li>
<li><a href="/userservices/allocations.php">Allocations</a></li>
<li><a href="/userservices/gettinghelp.php">Getting Help</a></li>
<li><a href="https://www.chpc.utah.edu/presentations/index.php">Training</a></li>
</ul>
</li>
<li class="has-sub sub-width-lg"><a href="#">Usage</a>
<ul class="sub-menu">
<li><a href="/usage/cluster/index.php">cluster usage</a>
<ul>
<li><a href="/usage/cluster/current-project-general.php">General Allocation Pool</a></li>
<li><a href="/usage/cluster/current-project-lonepeak.php">Lonepeak Cluster</a></li>
<li><a href="/usage/cluster/current-project-kingspeak.php">Kingspeak Cluster<br /></a></li>
<li><a href="/usage/cluster/current-project-ash.php">Ash Cluster<br /></a></li>
<li><a href="/usage/cluster/current-project-redwood.php">Redwood Cluster</a></li>
</ul>
</li>
<li><a href="/usage/graphs.php?g=cluster%20utilization&amp;host=combined&amp;type=daily_utilization">Cluster Utilization Graphs</a></li>
<li><a href="/usage/graphs.php?g=hpc%20cluster%20scratch&amp;host=chpc_gen&amp;type=cpu">HPC Cluster Scratch</a></li>
<li><a href="/usage/graphs.php?g=network&amp;host=Campus+Gateway&amp;type=daily_traffic">Network</a>
<ul>
<li><a href="/resources/maddash-dashboards.php">Maddash Dashboards</a></li>
</ul>
</li>
<li><a href="http://weathermap.uen.net/" target="_blank" rel="noopener">UEN Weathermap (Only Available on UEN Networks)</a></li>
<li><a href="http://snapp2.bldc.grnoc.iu.edu/i2al2s/#&amp;p=3%2C42&amp;ccid=3&amp;tab=1&amp;search=undefined&amp;pwidth=undefined&amp;ccat=undefined&amp;url=show-graph.cgi%3Fcollection_ids%3D145%26end%3D1461772131%26start%3D1461771831%26cf%3DAVERAGE%26ds%3Doutput%2Cinput%26collection_ids%3D145" target="_blank" rel="noopener">UEN Aggregate Utilization</a></li>
<li><a href="http://uofu.status.io">UofU It Services Status</a></li>
<li><a href="https://status.it.utah.edu">University Application Heath Summary - NOC</a></li>
</ul>
</li>
</ul>
</ul>
<p></p>
<ul class="uu-menu__level1">
<ul class="uu-menu__level1">
<li><a href="/role/">Sign In</a></li>
</ul>
</ul>
<p></p>	
</nav>

<!-- END HEADER NAVIGATION -->
                     </div>
                  <div class="uu-search-toggle"><button class="uu-search__trigger"><span class="far fa-search" aria-hidden="true"></span><span class="sr-only">Search</span></button></div><button id="jsNavTrigger" class="uu-nav__trigger" aria-haspopup="true" aria-expanded="false"><span class="sr-only">Reveal Menu</span><span></span></button></div>
            </div>
         </header>
         <!-- END HEADER -->
         <!-- PUSH NAVIGATION -->
         
         <section class="uu-nav">
            <div class="uu-nav__container"><button id="jsMobileNavTrigger" class="uu-nav__trigger" aria-haspopup="true" aria-expanded="false"><span class="sr-only">Reveal Menu</span><span></span></button><header class="uu-nav__header">
                  <h2 class="sr-only">Main Navigation</h2>
                  <!-- Navigation Logo -->
<a href="https://utah.edu/" class="uu-nav__logo">
	<img src="https://templates.utah.edu/_main-v3-1/images/template/university-of-utah-logo.svg" alt="The University of Utah"/>
</a></header>
               <nav class="uu-menu" aria-label="main"><p><h2 class="uu-menu__title">Main Menu</h2>
<hr />
<ul class="uu-menu__level1">
	<li><a href="/">Home</a></li>
	<li class="has-sublist"><a href="#">About Us</a>
		<ul class="uu-menu__level2">
			<li><a href="/about/index.php">About Us</a></li>
			<li><a href="/about/vision.php">vision</a></li>
			<li><a href="/about/staff.php">Staff</a></li>
			<li><a href="/about/contact.php">Contact Information</a></li>
			<li><a href="/about/acknowledge.php">acknowledging chpc</a></li>
			<li><a href="/about/bibliography/CHPC%20BIB.pdf" target="_blank">CHPC Bibliography</a></li>
			<li><a href="/about/SupportedResearch.php">Supported Research</a></li>
			<li><a href="/highlights.php">Research Highlights</a></li>
			<li><a href="/about/partners.php">Partners</a></li>
			<li><a href="/news/index.php">news</a></li>
			<li><a title="University Information Technology" href="https://it.utah.edu/" target="_blank">UIT</a></li>
			<li><a href="/about/governance.php">Governance</a></li>
		</ul>
	</li>
	<li class="has-sublist"><a href="#">Resources</a>
		<ul class="uu-menu__level2">
			<li><a href="/resources/index.php">Resources</a></li>
			<li><a href="/resources/HPC_Clusters.php">HPC Clusters</a></li>
			<li><a href="/resources/storage_services.php">Storage Services</a></li>
			<li><a href="/documentation/data_services.php">Data Transfer Services</a></li>
			<li><a href="/resources/virtualmachines.php">Virtual Machines</a></li>
			<li><a href="/resources/hosting.php">Hosting Services</a></li>
			<li><a href="/resources/Networking.php">Networking</a></li>
			<li><a href="/resources/ProtectedEnvironment.php">Protected Environment</a></li>
			<li><a href="/userservices/index.php">User Services</a></li>
		</ul>
	</li>
	<li class="has-sublist"><a href="#">Documentation</a>
		<ul class="uu-menu__level2">
			<li><a href="/documentation/index.php">Documentation</a></li>
			<li><a href="/documentation/gettingstarted.php">Getting Started</a></li>
			<li><a href="/resources/access.php">Accessing Our Resources</a></li>
			<li><a href="/documentation/videos/index.php">Short Training Videos</a></li>
			<li><a href="/documentation/guides/index.php">Cluster Guides</a></li>
			<li><a href="/documentation/guides/beehive.php">Beehive User Guide (Windows Server)</a></li>
			<li><a href="/documentation/guides/gpus-accelerators.php">GPU &amp; Accelerators</a></li>
			<li><a href="/documentation/guides/frisco-nodes.php">Frisco Nodes</a></li>
			<li><a href="/documentation/guides/narwhal.php">Narwhal User Guide (Protected Environment Statistics)</a></li>
			<li><a href="/documentation/software/index.php">Software</a></li>
			<li><a href="/documentation/ProgrammingGuide.php">Programming Guide</a></li>
			<li><a href="/documentation/policies/index.php">Policy Manual</a></li>
			<li><a href="/documentation/data_services.php">Data Transfer Services</a></li>
			<li><a href="/documentation/guides/HelloWorldMPI.php">HPC Basics - Hello World MPI</a></li>
			<li><a href="/documentation/faq.php">Frequently Asked Questions</a></li>
			<li><a href="/documentation/white_papers/index.php">White Papers</a></li>
		</ul>
	</li>
	<li class="has-sublist"><a href="#">User Services</a>
		<ul class="uu-menu__level2">
			<li><a href="/userservices/index.php">User Services</a></li>
			<li><a href="/userservices/accounts.php">Accounts</a></li>
			<li><a href="/userservices/allocations.php">Allocations</a></li>
			<li><a href="/userservices/gettinghelp.php">Getting Help</a></li>
			<li><a href="/presentations/index.php">Training</a></li>
		</ul>
	</li>
	<li class="has-sublist"><a href="#">Usage</a>
		<ul class="uu-menu__level2">
			<li class="has-sublist"><a href="/usage/cluster/index.php">cluster usage</a>
				<ul class="uu-menu__level3">
					<li><a href="/usage/cluster/current-project-general.php">General Allocation Pool</a></li>
					<li><a href="/usage/cluster/current-project-lonepeak.php">Lonepeak Cluster</a></li>
					<li><a href="/usage/cluster/current-project-kingspeak.php">Kingspeak Cluster<br /></a></li>
					<li><a href="/usage/cluster/current-project-ash.php">Ash Cluster<br /></a></li>
					<li><a href="/usage/cluster/current-project-redwood.php">Redwood Cluster</a></li>
				</ul>
			</li>
			<li><a href="/usage/graphs.php?g=cluster%20utilization&amp;host=combined&amp;type=daily_utilization">Cluster Utilization Graphs</a></li>
			<li><a href="/usage/graphs.php?g=hpc%20cluster%20scratch&amp;host=chpc_gen&amp;type=cpu">HPC Cluster Scratch</a></li>
			<li class="has-sublist"><a href="/usage/graphs.php?g=network&amp;host=Campus+Gateway&amp;type=daily_traffic">Network</a>
				<ul class="uu-menu__level3">
					<li><a href="/resources/maddash-dashboards.php">Maddash Dashboards</a></li>
				</ul>
			</li>
			<li class="has-sublist"><a href="http://weathermap.uen.net/" target="_blank">UEN Weathermap</a>
				<ul class="uu-menu__level3">
					<li><a href="http://weathermap.uen.net/" target="_blank">(Only Available on UEN Networks)</a></li>
				</ul>
			</li>
			<li><a href="http://snapp2.bldc.grnoc.iu.edu/i2al2s/#&amp;p=3%2C42&amp;ccid=3&amp;tab=1&amp;search=undefined&amp;pwidth=undefined&amp;ccat=undefined&amp;url=show-graph.cgi%3Fcollection_ids%3D145%26end%3D1461772131%26start%3D1461771831%26cf%3DAVERAGE%26ds%3Doutput%2Cinput%26collection_ids%3D145" target="_blank">UEN Aggregate Utilization</a></li>
			<li><a href="http://uofu.status.io">UofU It Services Status</a></li>
			<li><a href="https://status.it.utah.edu">University Application Heath Summary - NOC</a></li>
		</ul>
	</li>
	
	<li><a href="/role/">Sign In</a></li>
	
	
	
</ul>

</p></nav>
            </div>
         </section>
         <!-- END PUSH NAVIGATION -->
         
         <!-- MAIN CONTENT -->
         <main class="uu-main" id="skip-link-target">
            <nav aria-label="Breadcrumb" class="uu-breadcrumb">
               <ol>
                  <li><a href="/">Home</a></li>
                  <li><a href="/documentation/">documentation</a></li>
                  <li><a href="/documentation/software/">software</a></li>
                  <li><span class="sr-only">current page: </span>R</li>
               </ol>
            </nav>
            <!-- SECTION 1 -->
            
            <section class="uu-section bg-white text-default uu-section--region-1" style="">
               <div class="uu-section__container"><!-- SECTION HEADER -->
                  
                  <div class="uu-section__header  ">
                     <h1><span style="color: inherit; font-family: inherit; font-size: 22px; font-weight: bold; letter-spacing: -0.03em;">R (Programming Language)</span></h1>
                     <ul>
                        <li>
                           <p><a href="#rchpc">Using R at CHPC</a></p>
                           <ul style="list-style-type: circle;">
                              <li>
                                 <p><a href="#renv">How to load R in your environment?</a></p>
                              </li>
                              <li>
                                 <p><a href="#rcmd">Running an R batch script on the command line</a></p>
                              </li>
                              <li>
                                 <p><a href="#rscript">Runing a R batch script on the cluster (using SLURM)</a></p>
                              </li>
                              <li>
                                 <p><a href="#rmulti">Running an array of independent R batch jobs on the cluster</a></p>
                              </li>
                              <li>
                                 <p><a href="#rpar">Parallel R</a></p>
                              </li>
                              <li>
                                 <p><a href="#rstudio">RStudio</a></p>
                              </li>
                           </ul>
                        </li>
                        <li><a href="#rpkg">Installing additional R packages</a><br><ul>
                              <li><a style="background-color: #ffffff;" href="#rpkg-bckg">R library locations</a></li>
                              <li><a href="#rpkg-setup">Setting up your own library</a></li>
                              <li><a href="#rpkg-inst">Installing packages in your environment</a><ul>
                                    <li><a style="background-color: #ffffff;" href="#rpkg-high">High level installation</a></li>
                                    <li><a href="#rpkg-low">Low level installation</a></li>
                                 </ul>
                              </li>
                              <li><a href="#prob">Potential problems</a></li>
                           </ul>
                        </li>
                     </ul>
                  </div>
                  <!-- END SECTION HEADER -->
                  <!-- REGION 1 -->
                  
                  <div class="uu-section__region bg-white text-default no-border">
                     <p>&nbsp;</p>
                     <hr>
                     <p><a href="https://www.r-project.org/">R</a> is a programming language and software environment for <span class="mw-redirect">statistical computing</span> and graphics.</p>
                     <p>For use on the notchpeak, kingspeak, lonepeak, and ash clusters, and on Linux desktops,
                        we have installed R from the source code. We also installed a number of external R
                        libraries. If there is another library that you want to use, please try to&nbsp;<a href="#rpkg">install the library in your own environment</a>. If you run into trouble, feel free to ask us to perform the installation.</p>
                     <p>The currently supported version is 4.1.3 (Rocky 8). It was built with the GNU compilers
                        and its threaded Math Kernel Library (MKL). The presence of MKL may result in a considerable
                        speed-up when compared to R builds which rely solely on non-optimized mathematical
                        libraries. As a rule of thumb, programs that use a lot of floating point numerical
                        calculations should benefit from multi-threading the most.</p>
                     <p>By default we have <strong>turned off multi-threading</strong> by setting the environmental variable OMP_NUM_THREADS to 1, i.e.</p>
                     <!-- PANEL -->
                     <div class="c-panel bg-light-gray text-default has-filter  " data-filter-terms="sample1 sample2" style=" ">
                        <pre>setenv OMP_NUM_THREADS 1   # Tcsh/Csh Shell<br>export OMP_NUM_THREADS=1   # Bash Shell</pre>
                     </div>
                     <!-- END PANEL -->
                     
                     <p>to facilitate easier use of parallel independent calculations. If you want to run
                        R in a multithreaded fashion (e.g. on a compute node), we strongly recommend not to
                        use more threads than there are physical cores on the node.</p>
                     <h2><a id="renv"></a>How to load R in your environment</h2>
                     <p>You can obtain R in your environment by loading the R module i.e.:</p>
                     <!-- PANEL -->
                     <div class="c-panel bg-light-gray text-default has-filter  " data-filter-terms="sample1 sample2" style=" ">
                        <p>module load R</p>
                     </div>
                     <!-- END PANEL -->
                     
                     <p>&nbsp;</p>
                     <p>The command <code style="background-color: lightgray;">R --version</code> returns the version of R you have loaded:</p>
                     <!-- PANEL -->
                     <div class="c-panel bg-light-gray text-default has-filter  " data-filter-terms="sample1 sample2" style=" ">
                        <p>R --version</p>
                        <p>R version 4.1.3 (2022-03-10) -- "One Push-Up"<br>Copyright (C) 2022 The R Foundation for Statistical Computing<br>Platform: x86_64-pc-linux-gnu (64-bit)</p>
                     </div>
                     <!-- END PANEL -->
                     
                     <p>&nbsp;</p>
                     <p>The command <code style="background-color: lightgray;">which R</code> returns the location where the R executable resides:</p>
                     <!-- PANEL -->
                     <div class="c-panel bg-light-gray text-default has-filter  " data-filter-terms="sample1 sample2" style=" ">
                        <p>which R</p>
                        <p>/uufs/chpc.utah.edu/sys/installdir/r8/R/4.1.3/bin/R</p>
                     </div>
                     <!-- END PANEL -->
                     
                     <p>&nbsp;</p>
                     <p><span color="red">We also maintain a number of older versions of R. You can list these versions with
                           the command "module spider R", and load a specific version with a command such as
                           "module load R/4.1.1".</span><strong><span color="red" style="color: red;"><br></span></strong></p>
                     <p><strong><span color="red" style="color: red;">Note: if you use an ~/.Rprofile file, it should be independent of the version of R,
                              i.e. library paths should NEVER be set within this file.</span></strong></p>
                     <h2><a id="rcmd"></a>Running an R batch script on the command line</h2>
                     <p>There are several ways to launch an R script on the command line:</p>
                     <ol>
                        <li>
                           <p><code style="background-color: lightgray;">Rscript yourfile.R</code></p>
                        </li>
                        <li>
                           <p><code style="background-color: lightgray;">R CMD BATCH yourfile.R</code></p>
                        </li>
                        <li>
                           <p><code style="background-color: lightgray;">R --no-save &lt; yourfile.R</code></p>
                        </li>
                        <li>
                           <p><code style="background-color: lightgray;">./yourfile2.R</code></p>
                        </li>
                     </ol>
                     <p>The <strong>first</strong> approach (i.e. using the <code style="background-color: lightgray;">Rscript</code> command) redirects the output into stdout. The <strong>second</strong> approach (i.e. using the <code style="background-color: lightgray;">R CMD BATCH</code> command) redirects its output into a file (in case <code style="background-color: lightgray;">yourfile.Rout</code>). &nbsp;A <strong>third</strong> approach is to redirect the input of the file <code style="background-color: lightgray;">yourfile.R</code> to the R executable. Note that in the latter approach you <strong>must</strong> specify one of the following flags: <code style="background-color: lightgray;">--save</code>, <code style="background-color: lightgray;"> --no-save</code> or <code style="background-color: lightgray;">--vanilla.</code></p>
                     <p>The R code can be launched as a Linux script (<b>fourth</b>&nbsp;approach) as well. In order to be run as a Linux script:</p>
                     <ul>
                        <li>
                           <p>One needs to insert an extra line (<span>#!/usr/bin/env Rscript)</span> at the top of the file yourfile.R&nbsp;</p>
                        </li>
                        <li>
                           <p>As a result we have a new file yourfile2.R</p>
                        </li>
                        <li>
                           <p>The permissions of the R script (i.e.<code style="background-color: lightgray;">yourfile2.R)</code>need to be altered (-&gt; executable)</p>
                        </li>
                     </ul>
                     <p>The files <a href="/documentation/software/scripts/seaice.R">seaice.R</a> and <a href="/documentation/software/scripts/seaice2.R">seaice2.R</a> can be used/seen as examples for <code style="background-color: lightgray;">yourfile.R</code>, respectively <code style="background-color: lightgray;">yourfile2.R</code>. Note that the scripts <code style="background-color: lightgray;">seaice.R</code> and <code style="background-color: lightgray;">seaice2.R</code><strong>require</strong> the data file <a href="https://www.chpc.utah.edu/documentation/software/scripts/sea-ice.txt">sea-ice.txt</a>.</p>
                     <p>Sometimes we need to feed arguments to the R script. This is especially useful if
                        running parallel independent calculations - different arguments can be used to differentiate
                        between the calculations, e.g. by feeding in different initial parameters. To read
                        the arguments, one can use the&nbsp;<code style="background-color: lightgray;">commandArgs()</code>&nbsp;function, e.g., if we have a script called&nbsp;<span></span><code style="background-color: lightgray;">myScript</code>:</p>
                     <!-- PANEL -->
                     <div class="c-panel bg-light-gray text-default has-filter  " data-filter-terms="sample1 sample2" style=" ">
                        <p class="lang-r prettyprint prettyprinted"><code style="background-color: lightgray;"><span class="com">## myScript.R</span><span class="pln">
                                 						args </span><span class="pun">&lt;-</span><span class="pln"> commandArgs</span><span class="pun">(</span><span class="pln">trailingOnly </span><span class="pun">=</span><span class="pln"></span><span class="lit">TRUE</span><span class="pun">)</span><span class="pln">
                                 						rnorm</span><span class="pun">(</span><span class="pln">n</span><span class="pun">=</span><span class="pln">as.numeric</span><span class="pun">(</span><span class="pln">args</span><span class="pun">[</span><span class="lit">1</span><span class="pun">]),</span><span class="pln"> mean</span><span class="pun">=</span><span class="pln">as.numeric</span><span class="pun">(</span><span class="pln">args</span><span class="pun">[</span><span class="lit">2</span><span class="pun">]))</span></code></p>
                     </div>
                     <!-- END PANEL -->
                     
                     <p>&nbsp;</p>
                     <p>then we can call it with arguments as e.g.:</p>
                     <!-- PANEL -->
                     <div class="c-panel bg-light-gray text-default has-filter  " data-filter-terms="sample1 sample2" style=" ">
                        <p class="lang-r prettyprint prettyprinted"><code style="background-color: lightgray;"><span class="pun">&gt;</span><span class="pln"> Rscript myScript.R </span><span class="lit">5</span><span class="pln"></span><span class="lit">100</span><span class="pln"></span><span class="pun">[</span><span class="lit">1</span><span class="pun">]</span><span class="pln"></span><span class="lit">98.46435</span><span class="pln"></span><span class="lit">100.04626</span><span class="pln"></span><span class="lit">99.44937</span><span class="pln"></span><span class="lit">98.52910</span><span class="pln"></span><span class="lit">100.78853</span></code></p>
                     </div>
                     <!-- END PANEL -->
                     
                     <p>&nbsp;</p>
                     <h2><a id="rscript"></a>Running a R batch script on the cluster (using SLURM)</h2>
                     <p>In the previous section we described how to launch an R script on the command line.
                        In order to run a R batch job on the compute nodes we just need to create a SLURM
                        script/wrapper "around" the R command line.</p>
                     <p>Below you will find the content of the corresponding Slurm batch script <a href="/documentation/software/scripts/runR.sl">runR.sl</a>:</p>
                     <!-- PANEL -->
                     <div class="c-panel bg-light-gray text-default has-filter  " data-filter-terms="sample1 sample2" style=" ">
                        <p>#!/bin/bash<br>#SBATCH --time=00:10:00 # Walltime<br>#SBATCH --nodes=1 # Use 1 Node (Unless code is multi-node parallelized)<br>#SBATCH --ntasks=1 # We only run one R instance = 1 task<br>#SBATCH --cpus-per-task=32 # number of threads we want to run on<br>#SBATCH --account=owner-guest<br>#SBATCH --partition=notchpeak-guest<br>#SBATCH -o slurm-%j.out-%N<br>#SBATCH --mail-type=ALL<br>#SBATCH --mail-user=$USER@utah.edu # Your email address<br>#SBATCH --job-name=seaIce<br><br>export FILENAME=seaice.R<br>export SCR_DIR=/scratch/general/nfs1/$USER/$SLURM_JOBID<br>export WORK_DIR=$HOME/TestBench/R/SeaIce<br><br># Load R (version 4.1.3)<br>module load R<br><br># Take advantage of all the threads (linear algebra)<br># $SLURM_CPUS_ON_NODE returns actual number of cores on node<br># rather than $SLURM_JOB_CPUS_PER_NODE, which returns what --cpus-per-task asks for<br>export OMP_NUM_THREADS=$SLURM_CPUS_ON_NODE<br><br># Create scratch &amp; copy everything over to scratch<br>mkdir -p $SCR_DIR<br>cd $SCR_DIR<br>cp -p $WORK_DIR/* .<br><br># Run the R script in batch, redirecting the job output to a file<br>Rscript $FILENAME &gt; $SLURM_JOBID.out<br><br># Copy results over + clean up<br>cd $WORK_DIR<br>cp -pR $SCR_DIR/* .<br>rm -rf $SCR_DIR<br><br>echo "End of program at `date`"</p>
                     </div>
                     <!-- END PANEL -->
                     
                     <p>&nbsp;</p>
                     <p>We run the script under Slurm as&nbsp;<span><code style="background-color: lightgray;">sbatch runR.sl</code></span>.</p>
                     <h2><a id="rmulti"></a>Running many independent R batch caculations as one job</h2>
                     <p>We mentioned above that both versions of R were built using the multi-threaded MKL
                        library. The thread based parallelization is useful for vectorized R programs, but,
                        not all workflows vectorize. Therefore, if one has many independent calculations to
                        run, it is more efficient to run single threaded R and&nbsp;use SLURM's capability of running
                        independent calculations within a job in parallel. The SLURM script beneath (<code style="background-color: lightgray;">myRArr.sl</code>) lets you run an independent R job on each core of a node. Note that you also need
                        one or several scripts which perform the actual calculation. The SLURM script (<a href="https://www.chpc.utah.edu/documentation/software/scripts/myRArr.sl">myRArr.sl</a>), the R wrapper script (<a href="https://www.chpc.utah.edu/documentation/software/scripts/rwrapper.sh">rwrapper.sh</a>) and the actual R script (<a href="/documentation/software/scripts/mcex.r">mcex.r</a>).</p>
                     <!-- PANEL -->
                     <div class="c-panel bg-light-gray text-default has-filter  " data-filter-terms="sample1 sample2" style=" ">
                        <p>#!/bin/bash<br>#SBATCH --time=00:20:00 <br>#SBATCH --nodes=1 <br>#SBATCH --mail-type=FAIL,BEGIN,END<br>#SBATCH --mail-user=$USER@utah.edu<br>#SBATCH -o out.%j <br>#SBATCH -e err.%j<br>#SBATCH --account=owner-guest<br>#SBATCH --partition=lonepeak-guest<br>#SBATCH --job-name=test-RArr<br><br># Job Parameters<br>export EXE=./rwrapper.sh<br>export WORK_DIR=~/TestBench/Slurm/RMulti<br>export SCRATCH_DIR=/scratch/local/$USER/$SLURM_JOBID<br>export SCRIPT_DIR=$WORK_DIR/RFiles<br>export OUT_DIR=$WORK_DIR/`echo $UUFSCELL | cut -b1-4`/$SLURM_JOBID<br><br># Load R<br>module load R<br><br># Run an array of serial jobs<br>export OMP_NUM_THREADS=1<br><br>echo " Calculation started at:`date`"<br>echo " #$SLURM_TASKS_PER_NODE cores detected on `hostname`"<br><br># Create the my.config.$SLURM_JOBID file on the fly<br>for (( i=0; i &lt; $SLURM_TASKS_PER_NODE ; i++ )); \<br>do echo $i $EXE $i $SCRATCH_DIR/$i $SCRIPT_DIR $OUT_DIR/$i ; \<br>done &gt; my.config.$UUFSCELL.$SLURM_JOBID<br><br># Running a task on each core<br>cd $WORK_DIR<br>srun --multi-prog my.config.$UUFSCELL.$SLURM_JOBID<br><br># Clean-up the root scratch dir<br>rm -rf $SCRATCH_DIR<br><br>echo " Calculation ended at:`date`"</p>
                     </div>
                     <!-- END PANEL -->
                     
                     <p>&nbsp;</p>
                     <h2><a id="rpar"></a>Parallel R</h2>
                     <p>The R environment itself is not parallelized, which is important to keep in mind when
                        running on CHPC cluster nodes which have at least 8 CPU cores. Typical unvectorized
                        R programs will run using only a single core.</p>
                     <p>The R installation detailed above can run certain workloads (mostly linear algebra)
                        using multiple threads through the Intel Math Kernel Library (MKL). We recommend to
                        benchmark your first run using OMP_NUM_THREADS=1, and then using higher core count
                        (e.g. for 8 core node, OMP_NUM_THREADS=8), to see if it achieves any speed-up.</p>
                     <p>If the multi-threading does not provide much speedup, or, one needs to run on more
                        than one node, some kind of parallelization of the R code is necessary. There are
                        numerous R packages that implement various levels of parallelism, which are summarized
                        at <a href="http://cran.r-project.org/web/views/HighPerformanceComputing.html" target="_blank" rel="noopener">this CRAN page</a>.</p>
                     <p>If&nbsp;the&nbsp;computational&nbsp;tasks are independent of each other, one can relatively simply
                        use the <a href="http://cran.r-project.org/web/packages/foreach/index.html" target="_blank" rel="noopener">foreach</a> package, or <a href="https://www.r-bloggers.com/how-to-go-parallel-in-r-basics-tips/" target="_blank" rel="noopener">parallelized versions of the *apply functions</a>, which use the <a href="https://www.rdocumentation.org/packages/parallel" target="_blank" rel="noopener">parallel</a> package's multiple R workers. It is most common to equate the number of R workers
                        to the CPU cores (SLURM job tasks), and set OMP_NUM_THREADS=1 to turn off the multi-threading.
                        For running on a single compute node, here are the <a href="https://github.com/CHPC-UofU/CHPC-presentations/blob/master/Intro-to-Parallel-Computing/R-examples/R-parallel-onenode-iris.slr">SLURM script example</a> and <a href="https://github.com/CHPC-UofU/CHPC-presentations/blob/master/Intro-to-Parallel-Computing/R-examples/parallel-onenode-iris.R">R code example</a>.</p>
                     <p>To run on multiple cluster compute nodes, one also has to tell R what hosts to run
                        on. This requires creating a list of hosts in the SLURM script,&nbsp;<span>&nbsp;</span><span><code style="background-color: lightgray;">srun -n $SLURM_NTASKS hostname &gt; hostlist.txt</code></span><span>&nbsp;(like in <a href="https://github.com/CHPC-UofU/CHPC-presentations/blob/master/Intro-to-Parallel-Computing/R-examples/R-parallel-multinode-iris.slr" target="_blank" rel="noopener">this SLURM script</a>), and inside of the R program, feeding this list to the <a href="https://www.rdocumentation.org/packages/parallel" target="_blank" rel="noopener">makeCluster()</a> function, as in the <a href="https://github.com/CHPC-UofU/CHPC-presentations/blob/master/Intro-to-Parallel-Computing/R-examples/parallel-multinode-iris.R">following example</a>, which would work on any number of cluster nodes:</span></p>
                     <!-- PANEL -->
                     <div class="c-panel bg-light-gray text-default has-filter  " data-filter-terms="sample1 sample2" style=" ">
                        <p><span># load the parallel libraries<br>library(parallel)<br>library(foreach)<br>library(doParallel)<br># import hostlist<br>hostlist &lt;- paste(unlist(read.delim(file="hostlist.txt", header=F, sep =" ")))<br># launch the parallel R workers<br>cl &lt;- makeCluster(hostlist)<br>registerDoParallel(cl)<br># Fix bug in R &lt; 4.0, give the workers path to optional R packages<br># clusterEvalQ(cl,.libPaths("/uufs/chpc.utah.edu/sys/installdir/RLibs/3.5.2i"))<br># run the parallel calculation<br>x &lt;- iris[which(iris[,5] != "setosa"), c(1,5)]<br>trials &lt;- 10000<br>system.time({<br>r &lt;- foreach(icount(trials), .combine=rbind) %dopar% {<br>ind &lt;- sample(100, 100, replace=TRUE)<br>result1 &lt;- glm(x[ind,2]~x[ind,1], family=binomial(logit))<br>coefficients(result1)<br>}<br>})<br></span></p>
                     </div>
                     <!-- END PANEL -->
                     
                     <p>&nbsp;</p>
                     <p><span>Finally, some R libraries have their internal parallelization. To quickest way to
                           find out if the library/function that you are using can be run in parallel is to do
                           a web search.</span></p>
                     <p><span>For example, to find if library <code style="background-color: lightgray;">momentuHMM</code> has any parallel options, we can search for <a href="https://www.google.com/search?q=R+momentuHMM+parallel" target="_blank" rel="noopener">R momentuHMM parallel</a>. The first hit is the <a href="https://cran.r-project.org/web/packages/momentuHMM/momentuHMM.pdf" target="_blank" rel="noopener">library's manual</a>. Searching for the <code style="background-color: lightgray;">parallel</code> keyword in the manual, we can find a few functions that allow parallel processing.</span></p>
                     <h2><span><a id="rstudio"></a>RStudio</span><span></span></h2>
                     <p>RStudio is an <a href="https://en.wikipedia.org/wiki/Integrated_development_environment">Integrated Development Environment</a> (IDE) for R. It includes a console, syntax highlighting editor that supports direct
                        code execution, as well as tools for plotting, debugging, history and workspace management.
                        For more information see <a href="http://www.rstudio.com/products/RStudio/">RStudio webpage</a>.</p>
                     <p>RStudio is installed on Linux systems and can be invoked (after loading R) as follows:</p>
                     <!-- PANEL -->
                     <div class="c-panel bg-light-gray text-default has-filter  " data-filter-terms="sample1 sample2" style=" ">
                        <p>module load RStudio<br>rstudio</p>
                     </div>
                     <!-- END PANEL -->
                     
                     <p>&nbsp;</p>
                     <h2><a id="rpkg"></a>Installing additional R packages</h2>
                     <h4><a id="rpkg-bckg"></a>R library locations</h4>
                     <p>R packages are installed in libraries. Before addressing the installation of R packages
                        as such, we will first detail&nbsp;the hierarchical structure of the R libraries that are
                        installed on the CHPC Linux systems.</p>
                     <p>The command <code style="background-color: lightgray;">.libPaths()</code> returns the names of the libraries (directories) which are accessible to the R executable
                        which has been loaded in your environment.</p>
                     <p>In the recently installed R distributions, we can have three library levels:</p>
                     <ul>
                        <li>
                           <p>Core/Default Library</p>
                        </li>
                        <li>
                           <p>Site Library</p>
                        </li>
                        <li>
                           <p>User Libraries</p>
                        </li>
                     </ul>
                     <p>The <strong>Core &amp; Default R Packages</strong>&nbsp;were installed in a sub directory of the main installation directory when a new version
                        of R was compiled. The location of the library can be retrieved by the <code style="background-color: lightgray;">.Library</code> command. Among the packages in this library we have "base", "datasets", "utils",
                        etc.</p>
                     <!-- PANEL -->
                     <div class="c-panel bg-light-gray text-default has-filter  " data-filter-terms="sample1 sample2" style=" ">
                        <p>which R<br>/uufs/chpc.utah.edu/sys/installdir/r8/R/4.1.3/bin/R<br><br>R&gt; .Library<br>[1] "/uufs/chpc.utah.edu/sys/installdir/r8/R/4.1.3/lib64/R/library"</p>
                     </div>
                     <!-- END PANEL -->
                     
                     <p>&nbsp;</p>
                     <p>The <strong>Site Library</strong> contains all the <strong>external packages</strong> that have been installed by the CHPC staff for a <strong>well-defined version of R</strong>, i.e. each version of R has its own Site Library &nbsp;(<em>note that each R version may have been compiled with a different version of a compiler,
                           different compiler flags or for a different version of the OS</em>). The location of the Site Library library can be found <strong>within R</strong> using either <code style="background-color: lightgray;">.Library.site</code> or <code style="background-color: lightgray;">Sys.getenv("R_LIBS_SITE")</code> or by invoking <code style="background-color: lightgray;">echo $R_LIBS_SITE</code> in the<strong> shell</strong>.</p>
                     <!-- PANEL -->
                     <div class="c-panel bg-light-gray text-default has-filter  " data-filter-terms="sample1 sample2" style=" ">
                        <p>echo $R_LIBS_SITE<br>/uufs/chpc.utah.edu/sys/installdir/RLibs/4.1.1/<br>R<br>&gt;.Library.site<br>[1] "/uufs/chpc.utah.edu/sys/installdir/RLibs/4.1.1/"<br>&gt;Sys.getenv("R_LIBS_SITE")<br>[1] "/uufs/chpc.utah.edu/sys/installdir/RLibs/4.1.1/"</p>
                     </div>
                     <!-- END PANEL -->
                     
                     <p>&nbsp;</p>
                     <p>The <strong>User Library</strong> is a subdirectory in the user's space (e. g. $HOME) where the <strong>user</strong> can install his/her packages. Note that each major version of R for which you want
                        to install your own packages, should have its own user library directory. Modern R
                        versions automatically set and create an user library location in user's home directory.\</p>
                     <h4><a id="rpkg-setup"></a>Setting up your own library</h4>
                     <p>In the following lines we will describe how to check if R User Library is active.
                        Please, note that the User Library is only compatible within the minor version, you
                        will need to make a new User Library for newer version (e.g. version 3.5 and 3.6).&nbsp;</p>
                     <!-- PANEL -->
                     <div class="c-panel bg-light-gray text-default has-filter  " data-filter-terms="sample1 sample2" style=" ">
                        <p>module load R<br>which R<br>/uufs/chpc.utah.edu/sys/installdir/R/4.1.1/bin/R<br>R<br>&gt; Sys.getenv("R_LIBS_USER")<br>[1] "~/R/x86_64-pc-linux-gnu-library/4.1"</p>
                     </div>
                     <!-- END PANEL -->
                     
                     <p>&nbsp;</p>
                     <p>This shows that R/4.1.1 has an User Library located at ~/R/x86_64-pc-linux-gnu-library/4.1.
                        <strong>If you see this, your User Library is set up</strong>. If you are using older versions of R that don't automatically set User Library,
                        proceed with instructions below.</p>
                     <p>The set-up of the <strong>User Library</strong> goes through the following steps:</p>
                     <p>NOTE: Do these steps only if the User Library above is not defined. <strong>You don't need to do these steps if you use R &gt;= 4.0.</strong></p>
                     <ol>
                        <li>
                           <p>Load an R module</p>
                           <p><code style="background-color: lightgray;">module load R</code></p>
                        </li>
                        <li>
                           <p>If you don't have created your own "modules" directory yet, then create your own module
                              directory (e.g. <code style="background-color: lightgray;">~/MyModules</code>).</p>
                           <p><code style="background-color: lightgray;">mkdir -p ~/MyModules</code></p>
                        </li>
                        <li>
                           <p>Create an R subdirectory in ~/MyModules. The R subdirectory will contain all your
                              own future R modules.</p>
                           <p><code style="background-color: lightgray;">mkdir ~/MyModules/R</code></p>
                        </li>
                        <li>
                           <p>Copy the R module from the CHPC modules directory into your own R module space. The
                              R_VERSION environment variable is defined inside of the module file to denote the
                              R version.</p>
                           <p><code style="background-color: lightgray;">cp /uufs/chpc.utah.edu/sys/modulefiles/CHPC-18/Core/R/$R_VERSION.lua ~/MyModules/R/$R_VERSION.$USER.lua</code></p>
                        </li>
                        <li>
                           <p>We will now create a new directory in our home directory where we will install our
                              new R packages that can be used with the CHPC executable of R:</p>
                           <p><code style="background-color: lightgray;">mkdir -p ~/RLibs/$R_VERSION</code></p>
                        </li>
                        <li>
                           <p>Edit the&nbsp;newly created module e.g.&nbsp;<span><code style="background-color: lightgray;">~/MyModules/R/$R_VERSION.$USER.lua</code>, to add the following line:<br><code style="background-color: lightgray;">setenv("R_LIBS_USER",pathJoin(os.getenv("HOME"),"RLibs",myModuleVersion()))</code><br></span></p>
                        </li>
                        <li>
                           <p>Unload the CHPC R module</p>
                           <p><code style="background-color: lightgray;">module unload R</code></p>
                        </li>
                        <li>
                           <p>We can only load the new module <strong>if the newly created module directory is visible to LMOD</strong>, i.e. when it is inserted in the MODULEPATH environmental variable. You can add it
                              to the LMOD MODULEPATH variable as follows:</p>
                           <p><code style="background-color: lightgray;">module use ~/MyModules\</code></p>
                           You can insert the <code style="background-color: lightgray;">module use ~/MyModules</code>&nbsp;statement in your <code style="background-color: lightgray;">~/.custom.sh</code>&nbsp;file or <code style="background-color: lightgray;">~/.custom.csh</code>&nbsp;file so that the new module becomes <strong>always</strong> visible.</li>
                     </ol>
                     <p>We have now set up our own <strong>User Library</strong> installation directory where we can install packages that can be compiled with the
                        same compiler that was used to build CHPC's version of R (i.e. the Intel compiler<span>)</span>.</p>
                     <h4><a id="rpkg-inst"></a>Installing packages in your environment<code style="background-color: lightgray;"></code></h4>
                     <p>After setting up the module for our own version of R and the User Library we can install
                        packages in our own environment. To start, we first need to load our own version of
                        R:<code style="background-color: lightgray;"></code></p>
                     <!-- PANEL -->
                     <div class="c-panel bg-light-gray text-default has-filter  " data-filter-terms="sample1 sample2" style=" ">
                        <p>module load R.$USER<br>echo $R_LIBS_USER</p>
                     </div>
                     <!-- END PANEL -->
                     
                     <p>&nbsp;</p>
                     <p>The content of $R_LIBS_USER should refer to your newly created directory (see Previous
                        Section #6). Within your new R environment you can also use .libPaths() to see the
                        paths to all your libraries.</p>
                     <p>We can now install libraries in 2 different ways:</p>
                     <ul>
                        <li>
                           <p>High-level version using <code style="background-color: lightgray;">install.packages()</code> (invoked within R)</p>
                        </li>
                        <li>
                           <p>Low-level version using <code style="background-color: lightgray;">R CMD INSTALL</code> (invoked from a Linux Shell)</p>
                        </li>
                     </ul>
                     <h4><a id="rpkg-high"></a>High-Level Installation</h4>
                     <p>The high-level installation is the easiest way to install packages. It is the <strong>preferred way</strong> when the package to be installed does <strong>not</strong> depend on C, C++, Fortran libraries which are installed in non-traditional directories,
                        and particularly when the R code is available via <a href="https://cran.r-project.org/">CRAN, the Comprehensive R Archive Network</a>. The R function to be invoked is <code style="background-color: lightgray;">install.packages():</code></p>
                     <!-- PANEL -->
                     <div class="c-panel bg-light-gray text-default has-filter  " data-filter-terms="sample1 sample2" style=" ">
                        <pre>R<br>&gt;library(maRketSim)<br>Error in library(maRketSim) : there is no package called ‘maRketSim’<br>&gt;install.packages(c("maRketSim"),<br>                  lib=c(paste("/uufs/chpc.utah.edu/common/home/",Sys.getenv("USER"),"/RLibs/",Sys.getenv("R_VERSION"),sep="")),<br>                  repos=c("http://cran.us.r-project.org"),verbose=TRUE)<br>&gt;library(maRketSim)</pre>
                     </div>
                     <!-- END PANEL -->
                     
                     <p>&nbsp;</p>
                     <p>The <code style="background-color: lightgray;">library($PACKAGE)</code> function tries to load a package <code style="background-color: lightgray;">$PACKAGE</code>. If R can't find it an error will be printed on stdout. The <code style="background-color: lightgray;">install.packages()</code> function has several flags. The <code style="background-color: lightgray;">lib</code> flag needs to be followed by the directory where you want to install the package
                        (should be <code style="background-color: lightgray;">$R_LIBS_USER</code>). From the installation output we notice that the <code style="background-color: lightgray;">install.packages()</code> function calls the low-level installation command (<code style="background-color: lightgray;">R CMD INSTALL</code>). This command will be discussed in the next section:<code style="background-color: lightgray;"></code></p>
                     <!-- PANEL -->
                     <div class="c-panel bg-light-gray text-default has-filter  " data-filter-terms="sample1 sample2" style=" ">
                        <pre>'/uufs/chpc.utah.edu/sys/installdir/R/4.1.1/lib64/R/bin/R CMD INSTALL -l \<br>'/uufs/chpc.utah.edu/common/home/$USER/RLibs/$R_VERSION' \<br>/tmp/RtmpH90XAY/downloaded_packages/maRketSim_0.9.2.tar.gz'</pre>
                     </div>
                     <!-- END PANEL -->
                     
                     <p>&nbsp;</p>
                     <p>An alternative install function is used by the <a href="https://www.bioconductor.org/">Bioconductor</a> software repository. Bioconductor is the primary repository for R code for the life
                        sciences, and uses the BiocManager::install() function:</p>
                     <p class="border-primary">BiocManager::install(pkgs)</p>
                     <p class="border-primary">&nbsp;Where "pkgs" is a character vector with one or more names of packages to be installed.
                        This command, for example will install the Bioconductor DESeq2 package:</p>
                     <!-- PANEL -->
                     <div class="c-panel bg-light-gray text-default has-filter  " data-filter-terms="sample1 sample2" style=" ">
                        <pre>BiocManager::install("DESeq2")</pre>
                     </div>
                     <!-- END PANEL -->
                     
                     <p>&nbsp;</p>
                     <p>BiocManager::install has a number of optional arguments. Run the command "?BiocManager::install"
                        within R to see the complete documentation on the function.</p>
                     <h4><a id="rpkg-low"></a>Low-Level Installation</h4>
                     <p>The low-level installation is to be used when you need to install R packages that
                        <strong>depend on external libraries that are installed in non-default locations</strong>.&nbsp;E.g. Let's consider the package <code style="background-color: lightgray;">RNetCDF</code> (already installed within CHPC's R). &nbsp;</p>
                     <p>The installation of this package depends on the <strong>external</strong> libraries <em>netcdf-c</em> and <em>udunits2</em>. The command to be invoked to install the <code style="background-color: lightgray;">RNetCDF</code> package in a User Library is (assuming bash shell:</p>
                     <!-- PANEL -->
                     <div class="c-panel bg-light-gray text-default has-filter  " data-filter-terms="sample1 sample2" style=" ">
                        <pre>module load intel netcdf-c udunits<br>export PATH=$NETCDFC/bin:$PATH (or in tcsh shell, setenv PATH $NETCDFC/bin:$PATH)<br>export PATH=$UDUNITS/bin:$PATH (or in tcsh shell, setenv PATH $UDUNITS/bin:$PATH)<br>wget https://cran.r-project.org/src/contrib/RNetCDF_1.9-1.tar.gz<br>R CMD INSTALL --library=/uufs/chpc.utah.edu/common/home/$USER/RLibs/$R_VERSION \ <br>              --configure-args="CPPFLAGS='-I$UDUNITS/include'\<br>                LDFLAGS='-Wl,-rpath=$NETCDFC/lib \<br>               -L$NETCDFC/lib -lnetcdf \<br>               -Wl,-rpath=$UDUNITS/lib\<br>               -L$UDUNITS/lib -ludunits2 ' \<br>               --with-nc-config=$NETCDFC/bin/nc-config " RNetCDF_1.9-1.tar.gz</pre>
                     </div>
                     <!-- END PANEL -->
                     
                     <p>&nbsp;</p>
                     <p><code style="background-color: lightgray;">R CMD INSTALL</code> calls <code style="background-color: lightgray;">./configure</code> under the hood. The best way to tackle such an installation is to download the tar.gz
                        file first, find the appropriate installation flags (different for each package!)
                        and then feed those flags to the <code style="background-color: lightgray;">R CMD INSTALL</code> command.</p>
                     <p>&nbsp;If you have trouble or questions, please send an email to <a href="mailto:helpdesk@chpc.utah.edu">helpdesk@chpc.utah.edu</a>.</p>
                     <h2><a id="prob"></a>Potential Problems</h2>
                     <h4>Package installation with CHPC built R</h4>
                     <p>The Intel compiler, that we use to build R, conflicts with gcc headers when using
                        complex data types, resulting in an error similar to the one below when installing
                        some R libraries:</p>
                     <p>&nbsp;</p>
                     <!-- PANEL -->
                     <div class="c-panel bg-light-gray text-default has-filter  " data-filter-terms="sample1 sample2" style=" ">
                        <pre><span class="tabs2_section tabs2_section_1 tabs2_section1 tab_section" data-header-only="false" tab_caption="Description" tab_caption_raw="Description" id="section_tab.1c9dc6d62b41d2007c6de6f019da15da" data-section-id="1c9dc6d62b41d2007c6de6f019da15da" style="display: block;" role="tabpanel" aria-hidden="false" aria-labelledby="section_tab.1c9dc6d62b41d2007c6de6f019da15da"><span id="section-1c9dc6d62b41d2007c6de6f019da15da" data-header-only="false" class="section "><span><span style="word-wrap: break-word; display: block;">/uufs/chpc.utah.edu/sys/installdir/intel/compilers_and_libraries_2018.1.163/linux/compiler/include/complex(310): error #308: member "std::complex&lt;double&gt;::_M_value" (declared at line 1337 of "/usr/include/c++/4.8.5/complex") is inaccessible<br> return __x / __y._M_value;</span></span></span></span></pre>
                     </div>
                     <!-- END PANEL -->
                     
                     <p>&nbsp;</p>
                     <p><span class="tabs2_section tabs2_section_1 tabs2_section1 tab_section" data-header-only="false" tab_caption="Description" tab_caption_raw="Description" data-section-id="1c9dc6d62b41d2007c6de6f019da15da" style="display: block;" role="tabpanel" aria-hidden="false" aria-labelledby="section_tab.1c9dc6d62b41d2007c6de6f019da15da">The workaround this is to disable this diagnostic error by creating (or modifying)
                           file <code style="background-color: lightgray;">~/.R/Makevars</code> such as:<span style="color: var(--cms-region--primary-black);"></span></span></p>
                     <!-- PANEL -->
                     <div class="c-panel bg-light-gray text-default has-filter  " data-filter-terms="sample1 sample2" style=" ">
                        <pre>CFLAGS += -wd308<br>CXXFLAGS += -wd308<br>CPPFLAGS += -wd308<br>PKG_CFLAGS += -wd308<br>PKG_CXXFLAGS += -wd308<br>PKG_CPPFLAGS += -wd308</pre>
                     </div>
                     <!-- END PANEL -->
                     
                     <p>&nbsp;</p>
                     <h4>Package installation in Open OnDemand RStudio Server App</h4>
                     <p>The RStudio Server does not run X, the Linux graphical environment. Some R librares
                        require X to install, for example library 'rpanel'. The symptom of this issue is an
                        error message like:</p>
                     <pre><span><span class="GD15MCFCEUB">Warning message:
In fun(libname, pkgname) : couldn't connect to display ":0"
Error in structure(.External(.C_dotTcl, ...), class = "tclObj") : 
  [tcl] couldn't connect to display ":0".</span></span></pre>
                     <p><span><span class="GD15MCFCEUB">These packages have to be installed in the FastX terminal session, as follows:</span></span></p>
                     <p><span><span class="GD15MCFCEUB"><span class="tabs2_section tabs2_section_1 tabs2_section1 tab_section" data-header-only="false" tab_caption="Description" tab_caption_raw="Description" id="section_tab.1c9dc6d62b41d2007c6de6f019da15da" data-section-id="1c9dc6d62b41d2007c6de6f019da15da" style="display: block;" role="tabpanel" aria-hidden="false" aria-labelledby="section_tab.1c9dc6d62b41d2007c6de6f019da15da"><span id="section-1c9dc6d62b41d2007c6de6f019da15da" data-header-only="false" class="section "><span style="word-wrap: break-word; display: block;">- open FastX terminal to one of our clusters<br>- load the Ondemand R module, e.g.:<br><code>ml R/3.6.2-ood-geospatial</code><br>- start R and do the installation:<br><code>R<br>&gt; install.packages('rpanel')</code><br>(answer 'yes' to use personal library)</span></span></span></span></span></p>
                     <p><code style="background-color: lightgray;"></code></p>
                     <p><code style="background-color: lightgray;"></code></p>
                  </div>
                  <!-- END REGION 1 -->
                  <!-- SECTION FOOTER -->
                  
                  <div class="uu-section__footer  ">
                     <p></p>
                  </div>
                  <!-- END SECTION FOOTER -->
                  </div>
            </section>
            <!-- END SECTION 1 -->
            <!-- SECTION 2 -->
            <!-- END SECTION 2 -->
            <!-- SECTION 3 -->
            <!-- END SECTION 3 -->
            <!-- SECTION 4 -->
            <!-- END SECTION 4 -->
            <!-- SECTION 5 -->
            <!-- END SECTION 5 -->
            </main>
         <!-- END MAIN CONTENT -->
         <!-- FOOTER -->
         
         <footer class="uu-footer"><div class="uu-footer__top">
   <div class="uu-footer__top-container">
      <div class="uu-footer__top-col1"><a href="https://www.utah.edu"><img src="https://templates.utah.edu/_main-v3-1/images/template/blocku.svg" alt="The University of Utah" class="uu-block-logo"></a><div class="department-name">
            <h2>The Center For High Performance Computing</h2>
         </div>
         <div class="department-address">
            <p>155 S 1452 E, RM. 405<br>SLC, UT 84112-0190<br>801.585.3791&nbsp;</p>
         </div>
      </div>
      <div class="uu-footer__top-col2">
         <h2 class="footer-heading">Stay in Touch</h2>
         <hr>
         <ul>
            <li><a href="https://map.utah.edu/index.html?code=inscc">Find Us</a></li>
            <li><a href="https://www.chpc.utah.edu/about/contact.php">Contact Us</a></li>
            <li><a href="mailto:helpdesk@chpc.utah.edu">Webmaster</a></li>
         </ul>
      </div>
      <div class="uu-footer__top-col5">
         <h2 class="footer-heading">Quick Links</h2>
         <hr>
         <ul>
            <li><a href="https://www.utah.edu/a-z/">A-Z Index</a></li>
            <li><a href="https://people.utah.edu/uWho/basic.hml">Campus Directory</a></li>
            <li><a href="https://www.map.utah.edu">Campus Map</a></li>
            <li><a href="https://map.utah.edu/?allshuttle=on">Shuttle Tracker </a></li>
            <li><a href="https://cis.utah.edu/">CIS</a></li>
            <li><a href="https://www.umail.utah.edu/">UMail</a></li>
            <li><a href="https://attheu.utah.edu/">@ The U</a></li>
         </ul>
      </div>
   </div>
</div><div class="uu-footer__bottom">
   <div class="uu-footer__bottom-container">
      <div class="uu-footer__bottom-col1"><a href="https://www.utah.edu/"><img src="https://templates.utah.edu/_main-v3-1/images/template/university-of-utah-logo.svg" alt="The University of Utah" class="uu-site-logo"></a></div>
      <div class="uu-footer__bottom-col2">
         <div class="legal">
            <p>© 2024 The University of Utah</p>
            <ul>
               <li><a href="https://www.utah.edu/indigenous-land-acknowledgment/index.php">Indigenous Land Acknowledgment</a></li>
               <li><a href="https://www.utah.edu/nondiscrimination/">Nondiscrimination &amp; Accessibility</a></li>
               <li><a href="https://www.utah.edu/disclaimer/">Disclaimer</a></li>
               <li><a href="https://www.utah.edu/privacy/">Privacy</a></li>
               <li><a href="https://www.utah.edu/credits-v3.php">Credits &amp; Attributions</a></li>
               <li><a href="https://attheu.utah.edu/media-contacts/">Media Contacts</a></li>
               <li><span id="directedit"></span></li>
            </ul>
         </div>
      </div>
      <div class="uu-footer__bottom-col3">
         <ul class="uu-social-list">
            <li><a href="https://twitter.com/uutah"><span class="fa-brands fa-x-twitter" aria-hidden="true"></span><span class="sr-only">X</span></a></li>
            <li><a href="https://www.facebook.com/universityofutah"><span class="fab fa-facebook" aria-hidden="true"></span><span class="sr-only">Facebook</span></a></li>
            <li><a href="https://www.instagram.com/universityofutah/"><span class="fab fa-instagram" aria-hidden="true"></span><span class="sr-only">Instagram</span></a></li>
            <li><a href="https://www.youtube.com/user/theuniversityofutah"><span class="fab fa-youtube" aria-hidden="true"></span><span class="sr-only">Youtube</span></a></li>
         </ul>
      </div>
   </div>
</div></footer>
         <!-- END FOOTER -->
         </div>
      <!-- FOOT CODE -->
      <script src="//templates.utah.edu/_main-v3-1/js/main.min.js"></script>
      
      
      
      
      
      
      
      <script src="//templates.utah.edu/_main-v3-1/js/directedit.js"></script><script><!--
window.onload = function(){ directedit(); }
//
			--></script>
      <script src="/_resources/js/custom.js"></script>
            
      <!-- END FOOT CODE -->
      
      <div id="hidden"><a id="de" href="https://a.cms.omniupdate.com/11/?skin=utah&amp;account=utah_home&amp;site=chpc2&amp;action=de&amp;path=/documentation/software/r-language.pcf">Last Updated: 6/4/24</a></div>
      <!-- END PAGE BODY -->
      </body>
</html>